# React è®¾è®¡ï¼šå£°æ˜å¼ UI

## æ ¸å¿ƒç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç²¾å¦™ä¹‹å¤„ï¼šUI = f(State)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  State â†’ render() â†’ Virtual DOM â†’ Diff â†’ æœ€å°åŒ–æ›´æ–°     â”‚
â”‚                                                        â”‚
â”‚  â€¢ å£°æ˜å¼ï¼šæè¿°"æ˜¯ä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"æ€ä¹ˆåš"                   â”‚
â”‚  â€¢ å¯é¢„æµ‹ï¼šç›¸åŒè¾“å…¥å¿…ç„¶ç›¸åŒè¾“å‡º                          â”‚
â”‚  â€¢ é«˜æ•ˆï¼šæ‰¹é‡æ›´æ–°ï¼Œå‡å°‘ DOM æ“ä½œ                         â”‚
â”‚  â€¢ ç»„åˆï¼šå°ç»„ä»¶ç»„åˆæˆå¤§åº”ç”¨                              â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å£°æ˜å¼ vs å‘½ä»¤å¼

```javascript
// å‘½ä»¤å¼ï¼ˆjQuery æ—¶ä»£ï¼‰
function updateCounter(count) {
  const el = document.getElementById('counter')
  el.textContent = count
  if (count > 10) {
    el.classList.add('warning')
  } else {
    el.classList.remove('warning')
  }
}

// å£°æ˜å¼ï¼ˆReactï¼‰
function Counter({ count }) {
  return (
    <div className={count > 10 ? 'warning' : ''}>
      {count}
    </div>
  )
}
// ä½ åªæè¿°æœ€ç»ˆçŠ¶æ€ï¼ŒReact è´Ÿè´£å¦‚ä½•æ›´æ–°
```

## Virtual DOM ä¸ Diff

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Virtual DOM = JavaScript å¯¹è±¡æè¿°çš„ UI æ ‘               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  // Virtual DOM å¯¹è±¡                                   â”‚
â”‚  {                                                     â”‚
â”‚    type: 'div',                                        â”‚
â”‚    props: { className: 'container' },                  â”‚
â”‚    children: [                                         â”‚
â”‚      { type: 'h1', props: {}, children: ['Hello'] },  â”‚
â”‚      { type: 'p', props: {}, children: ['World'] }    â”‚
â”‚    ]                                                   â”‚
â”‚  }                                                     â”‚
â”‚                                                        â”‚
â”‚  Diff ç®—æ³•ï¼ˆO(n) å¯å‘å¼ï¼‰ï¼š                             â”‚
â”‚  1. ä¸åŒç±»å‹å…ƒç´  â†’ é”€æ¯é‡å»º                             â”‚
â”‚  2. ç›¸åŒç±»å‹å…ƒç´  â†’ åªæ›´æ–°å˜åŒ–çš„å±æ€§                      â”‚
â”‚  3. åˆ—è¡¨ä½¿ç”¨ key â†’ æœ€å°åŒ–ç§»åŠ¨æ“ä½œ                       â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å•å‘æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å•å‘æ•°æ®æµ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚       â”‚                                 â”‚             â”‚
â”‚       â–¼                                 â”‚             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚             â”‚
â”‚    â”‚State â”‚â”€â”€â”€â–ºâ”‚ View   â”‚â”€â”€â”€â–ºâ”‚ Action â”‚â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚             â”‚
â”‚       â–²                          â”‚      â”‚             â”‚
â”‚       â”‚                          â”‚      â”‚             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â”‚
â”‚              setState()                  â”‚             â”‚
â”‚                                         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                                        â”‚
â”‚  æ•°æ®åªèƒ½å•å‘æµåŠ¨ï¼Œæ˜“äºè¿½è¸ªå’Œè°ƒè¯•                        â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»„ä»¶ç»„åˆæ¨¡å¼

```jsx
// ç»„åˆä¼˜äºç»§æ‰¿
function Card({ children, title }) {
  return (
    <div className="card">
      <h2>{title}</h2>
      {children}
    </div>
  )
}

function UserCard({ user }) {
  return (
    <Card title={user.name}>
      <p>{user.bio}</p>
      <Button>Follow</Button>
    </Card>
  )
}

// é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰
function withLoading(Component) {
  return function WithLoading({ isLoading, ...props }) {
    if (isLoading) return <Spinner />
    return <Component {...props} />
  }
}

// Render Props
function Mouse({ render }) {
  const [position, setPosition] = useState({ x: 0, y: 0 })
  // ... ç›‘å¬é¼ æ ‡ä½ç½®
  return render(position)
}

// ä½¿ç”¨
<Mouse render={({ x, y }) => <Cursor x={x} y={y} />} />
```

## Hooksï¼šå‡½æ•°å¼ç»„ä»¶çš„çŠ¶æ€

```jsx
// useState - çŠ¶æ€
const [count, setCount] = useState(0)

// useEffect - å‰¯ä½œç”¨
useEffect(() => {
  document.title = `Count: ${count}`
  return () => { /* cleanup */ }
}, [count])

// useCallback - ç¼“å­˜å‡½æ•°
const handleClick = useCallback(() => {
  setCount(c => c + 1)
}, [])

// useMemo - ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensive(data)
}, [data])

// useRef - æŒä¹…å¼•ç”¨
const inputRef = useRef(null)
inputRef.current.focus()

// è‡ªå®šä¹‰ Hook - é€»è¾‘å¤ç”¨
function useWindowSize() {
  const [size, setSize] = useState({ width: 0, height: 0 })
  useEffect(() => {
    const handleResize = () => {
      setSize({ width: window.innerWidth, height: window.innerHeight })
    }
    window.addEventListener('resize', handleResize)
    return () => window.removeEventListener('resize', handleResize)
  }, [])
  return size
}
```

## Fiber æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fiber = å¯ä¸­æ–­çš„æ¸²æŸ“                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  é—®é¢˜ï¼šé•¿æ—¶é—´æ¸²æŸ“é˜»å¡ä¸»çº¿ç¨‹                              â”‚
â”‚                                                        â”‚
â”‚  è§£å†³ï¼š                                                 â”‚
â”‚  1. å°†æ¸²æŸ“å·¥ä½œåˆ†æˆå°å•å…ƒï¼ˆFiber èŠ‚ç‚¹ï¼‰                   â”‚
â”‚  2. æ¯ä¸ªå•å…ƒå®Œæˆåæ£€æŸ¥æ˜¯å¦éœ€è¦è®©å‡ºæ§åˆ¶æƒ                  â”‚
â”‚  3. é«˜ä¼˜å…ˆçº§æ›´æ–°å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§æ¸²æŸ“                     â”‚
â”‚                                                        â”‚
â”‚  ä¼˜å…ˆçº§ï¼š                                               â”‚
â”‚  â€¢ Immediate: ç”¨æˆ·è¾“å…¥ã€ç‚¹å‡»                            â”‚
â”‚  â€¢ UserBlocking: æ‚¬åœã€æ»šåŠ¨                            â”‚
â”‚  â€¢ Normal: ç½‘ç»œè¯·æ±‚å®Œæˆ                                 â”‚
â”‚  â€¢ Low: æ•°æ®é¢„å–                                       â”‚
â”‚  â€¢ Idle: ä¸é‡è¦çš„åå°å·¥ä½œ                               â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Concurrent Mode ç‰¹æ€§

```jsx
// Suspense - å£°æ˜å¼åŠ è½½çŠ¶æ€
function App() {
  return (
    <Suspense fallback={<Spinner />}>
      <AsyncComponent />
    </Suspense>
  )
}

// useTransition - éé˜»å¡æ›´æ–°
function Search() {
  const [query, setQuery] = useState('')
  const [isPending, startTransition] = useTransition()

  const handleChange = (e) => {
    // ç´§æ€¥æ›´æ–°ï¼šè¾“å…¥æ¡†
    setQuery(e.target.value)
    // éç´§æ€¥æ›´æ–°ï¼šæœç´¢ç»“æœ
    startTransition(() => {
      setSearchResults(search(e.target.value))
    })
  }
}

// useDeferredValue - å»¶è¿Ÿå€¼
function List({ query }) {
  const deferredQuery = useDeferredValue(query)
  // deferredQuery ä¼šåœ¨ä¸å¿™æ—¶æ›´æ–°
  return <ExpensiveList query={deferredQuery} />
}
```

## Server Components (RSC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Components = æœåŠ¡ç«¯æ¸²æŸ“ + ç»„ä»¶åŒ–                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  Server Component:                                     â”‚
â”‚  â€¢ åœ¨æœåŠ¡ç«¯æ‰§è¡Œ                                         â”‚
â”‚  â€¢ å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿ                          â”‚
â”‚  â€¢ ä¸å‘é€åˆ°å®¢æˆ·ç«¯ï¼ˆé›¶ bundle å¤§å°ï¼‰                      â”‚
â”‚  â€¢ ä¸èƒ½æœ‰çŠ¶æ€å’Œäº‹ä»¶å¤„ç†                                  â”‚
â”‚                                                        â”‚
â”‚  Client Component:                                     â”‚
â”‚  â€¢ åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ                                         â”‚
â”‚  â€¢ å¯ä»¥æœ‰çŠ¶æ€ã€äº‹ä»¶ã€æµè§ˆå™¨ API                          â”‚
â”‚  â€¢ éœ€è¦ "use client" æŒ‡ä»¤                              â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```jsx
// Server Component (é»˜è®¤)
async function PostList() {
  const posts = await db.posts.findMany()  // ç›´æ¥æŸ¥æ•°æ®åº“
  return (
    <ul>
      {posts.map(post => (
        <PostItem key={post.id} post={post} />
      ))}
    </ul>
  )
}

// Client Component
"use client"
function LikeButton({ postId }) {
  const [liked, setLiked] = useState(false)
  return (
    <button onClick={() => setLiked(!liked)}>
      {liked ? 'â¤ï¸' : 'ğŸ¤'}
    </button>
  )
}
```

## è®¾è®¡å¯ç¤º

1. **å£°æ˜å¼** - æè¿°ç»“æœï¼Œè€Œéè¿‡ç¨‹
2. **ç»„åˆ** - å°è€Œä¸“ä¸€çš„ç»„ä»¶ç»„åˆ
3. **å•å‘æ•°æ®æµ** - å¯é¢„æµ‹ã€æ˜“è°ƒè¯•
4. **è™šæ‹ŸåŒ–** - æŠ½è±¡å±‚å¸¦æ¥ä¼˜åŒ–ç©ºé—´
5. **æ¸è¿›å¢å¼º** - Concurrent Modeã€RSC é€æ­¥å¼•å…¥
